results_layer_prune = {0.1: {'average_flops_pruned': 121982159656.96,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.0711402010917663,
  'average_time_ref': 1.2417243194580079,
  'average_rouge_pruned': {'rouge1': 0.4182168540942135,
   'rouge2': 0.18461451158561681,
   'rougeL': 0.2833980992275022,
   'rougeLsum': 0.34995836974110783},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.1345725951304596,
   'precisions': [0.3780058651026393,
    0.16354166666666667,
    0.09199395770392749,
    0.05766871165644172],
   'brevity_penalty': 1.0,
   'length_ratio': 1.2695457930007445,
   'translation_length': 6820,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.2: {'average_flops_pruned': 106494068889.6,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.0080876016616822,
  'average_time_ref': 1.2609508395195008,
  'average_rouge_pruned': {'rouge1': 0.398897039115952,
   'rouge2': 0.15710398281679094,
   'rougeL': 0.2653091859133988,
   'rougeLsum': 0.33150865660806833},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.11413373312122418,
   'precisions': [0.37538461538461537,
    0.1446875,
    0.07507936507936508,
    0.04161290322580645],
   'brevity_penalty': 1.0,
   'length_ratio': 1.2099776619508562,
   'translation_length': 6500,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.3: {'average_flops_pruned': 93043195811.84,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 0.9326514101028442,
  'average_time_ref': 1.253011531829834,
  'average_rouge_pruned': {'rouge1': 0.37369111722415105,
   'rouge2': 0.12867309034720995,
   'rougeL': 0.24723434284206175,
   'rougeLsum': 0.31243958857246135},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.09246971492712168,
   'precisions': [0.36550710436060757,
    0.12369251203719077,
    0.056052676008779334,
    0.028851107676455434],
   'brevity_penalty': 1.0,
   'length_ratio': 1.1397989575577065,
   'translation_length': 6123,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.4: {'average_flops_pruned': 81379799767.04,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 0.8796977829933167,
  'average_time_ref': 1.2503673315048218,
  'average_rouge_pruned': {'rouge1': 0.3419301587291808,
   'rouge2': 0.10223108070972972,
   'rougeL': 0.2211665991689351,
   'rougeLsum': 0.2799365360427141},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.07163820581744712,
   'precisions': [0.3452663725822871,
    0.1011391094235416,
    0.04056902002107481,
    0.018591347872720772],
   'brevity_penalty': 1.0,
   'length_ratio': 1.0971705137751302,
   'translation_length': 5894,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.5: {'average_flops_pruned': 71389093468.16,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 0.8498828649520874,
  'average_time_ref': 1.2474299836158753,
  'average_rouge_pruned': {'rouge1': 0.31728467784271086,
   'rouge2': 0.08510916327062074,
   'rougeL': 0.20645472269103826,
   'rougeLsum': 0.26268001251513173},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.05841943863244009,
   'precisions': [0.32820069204152247,
    0.08538732394366197,
    0.03207885304659498,
    0.012956204379562044],
   'brevity_penalty': 1.0,
   'length_ratio': 1.0759493670886076,
   'translation_length': 5780,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.6: {'average_flops_pruned': 62921241139.2,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 0.8394272756576538,
  'average_time_ref': 1.2412140274047851,
  'average_rouge_pruned': {'rouge1': 0.25660505688456775,
   'rouge2': 0.0510464860698495,
   'rougeL': 0.1681390900185309,
   'rougeLsum': 0.21731290381241858},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.03155241827398107,
   'precisions': [0.2783469352318111,
    0.052659480473581904,
    0.013671523655333693,
    0.004945960798681077],
   'brevity_penalty': 1.0,
   'length_ratio': 1.0720402084884586,
   'translation_length': 5759,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.7: {'average_flops_pruned': 55761348597.76,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 0.878724205493927,
  'average_time_ref': 1.2431861543655396,
  'average_rouge_pruned': {'rouge1': 0.13715545604546303,
   'rouge2': 0.009666747655451243,
   'rougeL': 0.10214602347967884,
   'rougeLsum': 0.12527620240044973},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.0,
   'precisions': [0.17862838915470494,
    0.011365686451380119,
    0.001102333272092596,
    0.0],
   'brevity_penalty': 1.0,
   'length_ratio': 1.0504467609828743,
   'translation_length': 5643,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}}}


results_layer_merge_keep_anchor = {0.1: {'average_flops_pruned': 135685306357.76,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.5420283365249634,
  'average_time_ref': 1.381700372695923,
  'average_rouge_pruned': {'rouge1': 0.42315634186415774,
   'rouge2': 0.19617889178211156,
   'rougeL': 0.28967391866832093,
   'rougeLsum': 0.3594699304078539},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.13771007453318232,
   'precisions': [0.37390579408086705,
    0.16669015076793012,
    0.09475489495498071,
    0.060896041757285774],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3397244973938942,
   'translation_length': 7197,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.2: {'average_flops_pruned': 128111469107.2,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.4516769123077393,
  'average_time_ref': 1.3932109665870667,
  'average_rouge_pruned': {'rouge1': 0.4057162570320646,
   'rouge2': 0.17294585583761785,
   'rougeL': 0.2728843428623607,
   'rougeLsum': 0.34098695280752894},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.11944112542906327,
   'precisions': [0.37059769107116763,
    0.1512679816105591,
    0.07918109287972301,
    0.04585052728106373],
   'brevity_penalty': 1.0,
   'length_ratio': 1.2738272524199554,
   'translation_length': 6843,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.3: {'average_flops_pruned': 118258627614.72,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.3207200789451599,
  'average_time_ref': 1.37888507604599,
  'average_rouge_pruned': {'rouge1': 0.40589649275808537,
   'rouge2': 0.16473363062909127,
   'rougeL': 0.26905621460118595,
   'rougeLsum': 0.3385011059791576},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.11735602325798883,
   'precisions': [0.38280144631347274,
    0.15221210669222168,
    0.07677325109560136,
    0.04240224385414948],
   'brevity_penalty': 1.0,
   'length_ratio': 1.184102755026061,
   'translation_length': 6361,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.4: {'average_flops_pruned': 107019167733.76,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.240582182407379,
  'average_time_ref': 1.376947250366211,
  'average_rouge_pruned': {'rouge1': 0.3969335320327565,
   'rouge2': 0.14833301392092302,
   'rougeL': 0.25735716882394577,
   'rougeLsum': 0.3328607873472554},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.10506611069911113,
   'precisions': [0.38323643410852715,
    0.1406762967826658,
    0.06692256341789052,
    0.033774609640190086],
   'brevity_penalty': 1.0,
   'length_ratio': 1.1526433358153387,
   'translation_length': 6192,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.5: {'average_flops_pruned': 94744410101.76,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.1597185468673705,
  'average_time_ref': 1.380140359401703,
  'average_rouge_pruned': {'rouge1': 0.37282952243228606,
   'rouge2': 0.12126701084375696,
   'rougeL': 0.23632129213329672,
   'rougeLsum': 0.30419607500052664},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.08558674210853946,
   'precisions': [0.3687813021702838,
    0.11850594227504245,
    0.050259067357512954,
    0.024428822495606326],
   'brevity_penalty': 1.0,
   'length_ratio': 1.1150409530900969,
   'translation_length': 5990,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.6: {'average_flops_pruned': 82331328419.84,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.063960680961609,
  'average_time_ref': 1.3770780277252197,
  'average_rouge_pruned': {'rouge1': 0.3302854521022135,
   'rouge2': 0.0990328371218991,
   'rougeL': 0.21815476724089045,
   'rougeLsum': 0.2747643206965173},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.06696339125885688,
   'precisions': [0.3442419954006722,
    0.09814514676751306,
    0.03704382908490739,
    0.01606575751914814],
   'brevity_penalty': 1.0,
   'length_ratio': 1.0523082650781832,
   'translation_length': 5653,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}},
 0.7: {'average_flops_pruned': 70092862330.88,
  'average_flops_ref': 125898794588.16,
  'average_time_pruned': 1.0361483311653137,
  'average_time_ref': 1.376973145008087,
  'average_rouge_pruned': {'rouge1': 0.26272174892201305,
   'rouge2': 0.058047968551373744,
   'rougeL': 0.17149576784703474,
   'rougeLsum': 0.2252657300784462},
  'average_rouge_ref': {'rouge1': 0.41425834811581425,
   'rouge2': 0.18859044332934705,
   'rougeL': 0.27937080844937434,
   'rougeLsum': 0.3495267949878762},
  'average_bleu_pruned': {'bleu': 0.03512063483823459,
   'precisions': [0.28345773303245964,
    0.059706765589118534,
    0.01636396331595037,
    0.005493499359091741],
   'brevity_penalty': 1.0,
   'length_ratio': 1.0724125093075205,
   'translation_length': 5761,
   'reference_length': 5372},
  'average_bleu_ref': {'bleu': 0.12994626205808327,
   'precisions': [0.36112979152656355,
    0.156373551465576,
    0.08873531444367658,
    0.05690259285213735],
   'brevity_penalty': 1.0,
   'length_ratio': 1.3840282948622487,
   'translation_length': 7435,
   'reference_length': 5372}}}

import matplotlib.pyplot as plt
import numpy as np

result_list = results_layer_merge_keep_anchor

prune_ratios = sorted(result_list.keys())
average_flops_pruned = []
average_flops_ref = []
average_time_pruned = []
average_time_ref = []
average_rouge1_pruned = []
average_rouge1_ref = []
average_rouge2_pruned = []
average_rouge2_ref = []
average_rougeL_pruned = []
average_rougeL_ref = []
average_bleu_pruned = []
average_bleu_ref = []
for ratio in prune_ratios:
    result = result_list[ratio]
    average_flops_pruned.append(result['average_flops_pruned'])
    average_flops_ref.append(result['average_flops_ref'])
    average_time_pruned.append(result['average_time_pruned'])
    average_time_ref.append(result['average_time_ref'])
    average_rouge1_pruned.append(result['average_rouge_pruned']['rouge1'])
    average_rouge1_ref.append(result['average_rouge_ref']['rouge1'])
    average_rouge2_pruned.append(result['average_rouge_pruned']['rouge2'])
    average_rouge2_ref.append(result['average_rouge_ref']['rouge2'])
    average_rougeL_pruned.append(result['average_rouge_pruned']['rougeL'])
    average_rougeL_ref.append(result['average_rouge_ref']['rougeL'])
    average_bleu_pruned.append(result['average_bleu_pruned']['bleu'])
    average_bleu_ref.append(result['average_bleu_ref']['bleu'])

prune_ratios = np.array(prune_ratios)
average_flops_pruned = np.array(average_flops_pruned)
average_flops_ref = np.array(average_flops_ref)
average_time_pruned = np.array(average_time_pruned)
average_time_ref = np.array(average_time_ref)
average_rouge1_pruned = np.array(average_rouge1_pruned)
average_rouge1_ref = np.array(average_rouge1_ref)
average_rouge2_pruned = np.array(average_rouge2_pruned)
average_rouge2_ref = np.array(average_rouge2_ref)
average_rougeL_pruned = np.array(average_rougeL_pruned)
average_rougeL_ref = np.array(average_rougeL_ref)
average_bleu_pruned = np.array(average_bleu_pruned)
average_bleu_ref = np.array(average_bleu_ref)

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, average_flops_pruned / 1e9, marker='o', label='Pruned Model FLOPs')
plt.axhline(y=average_flops_ref[0] / 1e9, color='r', linestyle='--', label='Reference Model FLOPs')
plt.xlabel('Pruning Ratio')
plt.ylabel('Average FLOPs (in billions)')
plt.title('Average FLOPs vs Pruning Ratio')
plt.legend()
plt.grid(True)
plt.show()

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, average_time_pruned, marker='o', label='Pruned Model Time')
plt.axhline(y=average_time_ref[0], color='r', linestyle='--', label='Reference Model Time')
plt.xlabel('Pruning Ratio')
plt.ylabel('Average Inference Time (seconds)')
plt.title('Average Inference Time vs Pruning Ratio')
plt.legend()
plt.grid(True)
plt.show()

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, average_rouge1_pruned, marker='o', label='Pruned Model ROUGE-1')
plt.axhline(y=average_rouge1_ref[0], color='r', linestyle='--', label='Reference Model ROUGE-1')
plt.xlabel('Pruning Ratio')
plt.ylabel('ROUGE-1 Score')
plt.title('ROUGE-1 Score vs Pruning Ratio')
plt.legend()
plt.grid(True)
plt.show()

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, average_rouge2_pruned, marker='o', label='Pruned Model ROUGE-2')
plt.axhline(y=average_rouge2_ref[0], color='r', linestyle='--', label='Reference Model ROUGE-2')
plt.xlabel('Pruning Ratio')
plt.ylabel('ROUGE-2 Score')
plt.title('ROUGE-2 Score vs Pruning Ratio')
plt.legend()
plt.grid(True)
plt.show()

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, average_rougeL_pruned, marker='o', label='Pruned Model ROUGE-L')
plt.axhline(y=average_rougeL_ref[0], color='r', linestyle='--', label='Reference Model ROUGE-L')
plt.xlabel('Pruning Ratio')
plt.ylabel('ROUGE-L Score')
plt.title('ROUGE-L Score vs Pruning Ratio')
plt.legend()
plt.grid(True)
plt.show()

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, average_bleu_pruned, marker='o', label='Pruned Model BLEU')
plt.axhline(y=average_bleu_ref[0], color='r', linestyle='--', label='Reference Model BLEU')
plt.xlabel('Pruning Ratio')
plt.ylabel('BLEU Score')
plt.title('BLEU Score vs Pruning Ratio')
plt.legend()
plt.grid(True)
plt.show()

relative_flops = average_flops_pruned / average_flops_ref[0]
relative_time = average_time_pruned / average_time_ref[0]

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, relative_flops, marker='o')
plt.xlabel('Pruning Ratio')
plt.ylabel('Relative FLOPs (Pruned / Reference)')
plt.title('Relative FLOPs vs Pruning Ratio')
plt.grid(True)
plt.show()

plt.figure(figsize=(8, 6))
plt.plot(prune_ratios, relative_time, marker='o')
plt.xlabel('Pruning Ratio')
plt.ylabel('Relative Inference Time (Pruned / Reference)')
plt.title('Relative Inference Time vs Pruning Ratio')
plt.grid(True)
plt.show()
